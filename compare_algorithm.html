<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>Searching Method</title>
		<style type="text/css">
			html { -webkit-user-select: none }
			canvas { border: 1px solid; background-color: #404040 }
		</style>
	</head>
	<body>
		<div>
			<span>Searching Algorithm:</span>
			<span>
				<input id="mini-max" type="radio" name="method">
				<label for="mini-max">Mini Max</label>
			</span>
			<span>
				<input id="alpha-beta" type="radio" name="method">
				<label for="alpha-beta">Alpha Beta</label>
			</span>
			<span>
				<input id="mtd-f" type="radio" name="method">
				<label for="mtd-f">MTD(f)</label>
			</span>
		</div>
		<canvas width=512 height=512></canvas>
		<script type="text/javascript">
			"use strict"
			function makeTree() {
				function makeNode(depth, width, x, y) {
					return ((depth > 0)
						? { x: x, y: y, score: 0,
							car: makeNode((depth - 1), (width >>> 1), (x - width), (y + 80)),
							cdr: makeNode((depth - 1), (width >>> 1), (x + width), (y + 80)) }
						: { x: x, y: y, score: Math.floor(32 * ((2 * Math.random()) - 1)) })
				}
				return makeNode(6, 128, 256, 16)
			}
			var canvas = document.querySelector("canvas"), ctx = canvas.getContext("2d")
			function drawTree(tree) {
				function drawNode(node) {
					if (node.car) {
						ctx.moveTo(node.x, node.y)
						ctx.lineTo(node.car.x, node.car.y)
						ctx.moveTo(node.x, node.y)
						ctx.lineTo(node.cdr.x, node.cdr.y)
						drawNode(node.car)
						drawNode(node.cdr)
					}
				}
				ctx.strokeStyle = "white"
				ctx.beginPath()
				drawNode(tree)
				ctx.stroke()
			}
			function* recurseNegaMax(func, node, child, alpha, beta) {
					ctx.strokeStyle = "yellow"
					ctx.beginPath()
					ctx.moveTo(node.x, node.y)
					ctx.lineTo(child.x, child.y)
					ctx.stroke()
					yield
					yield* func(child, alpha, beta)
			}
			function* negaMax(node) {
				function* recurse(child) {
					highlightPath(node, child)
					yield
					yield* negaMax(child)
				}
				if (node.car) {
					var score
					yield* recurseNegaMax(negaMax, node, node.car)
					yield* recurseNegaMax(negaMax, node, node.cdr)
					node.score = (- Math.min(node.car.score, node.cdr.score))
				}
			}
			var alphaMap = (new Map()), betaMap = (new Map())
			function* memoAlphaBeta(node, alpha=(- Infinity), beta=Infinity) {
				if (node.car) {
					var score
					score = alphaMap.get(node)
					if (score >= beta) {
						node.score = score
					} else {
						if (score > alpha) {
							alpha = score
						}
						score = betaMap.get(node)
						if (score <= alpha) {
							node.score = score
						} else {
							if (score < beta) {
								beta = score
							}
							yield* recurseNegaMax(memoAlphaBeta, node, node.car, (- beta), (- alpha))
							score = (- node.car.score)
							if (score >= beta) {
								node.score = score
								alphaMap.set(node, score)
							} else {
								if (score > alpha) {
									alpha = score
								}
								yield* recurseNegaMax(memoAlphaBeta, node, node.cdr, (- beta), (- alpha))
								score = (- Math.min(node.car.score, node.cdr.score))
								node.score = score
								if (score >= beta) {
									alphaMap.set(node, score)
								} else {
									if (score > alpha) {
										alphaMap.set(node, score)
									}
									betaMap.set(node, score)
								}
							}
						}
					}
				}
			}
			function* mtdf(tree) {
				var f = 0, alpha = (- Infinity), beta = Infinity
				do {
					yield* memoAlphaBeta(tree, f, (f + 1))
					if (tree.score <= f) {
						beta = tree.score
						f = (tree.score - 1)
					} else {
						alpha = tree.score
						f = tree.score
					}
				} while (alpha < beta)
				window.alert("MTD(f) Search Finished")
			}
			var makeEventListener = (function() {
				var tree = makeTree(), gen
				return function(func) {
					return function() {
						ctx.clearRect(0, 0, 512, 512)
						drawTree(tree)
						if (!gen) {
							canvas.addEventListener("click", function() {
								gen.next()
							})
						}
						alphaMap.clear()
						betaMap.clear()
						gen = func(tree)
					}
				}
			})()
			function setEventListener(id, func) {
				document.getElementById(id).addEventListener("change", makeEventListener(func))
			}
			setEventListener("mini-max", negaMax)
			setEventListener("alpha-beta", memoAlphaBeta)
			setEventListener("mtd-f", mtdf)
		</script>
	</body>
</html>
